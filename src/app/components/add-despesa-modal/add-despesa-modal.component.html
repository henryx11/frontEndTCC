<div class="modal-overlay" (click)="fecharModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>ðŸ’¸ Adicionar Despesa</h3>
      <button class="btn-fechar-modal" (click)="fecharModal()" title="Fechar">
        âœ•
      </button>
    </div>

    <div class="modal-body">
      <form [formGroup]="despesaForm" (ngSubmit)="adicionarDespesa()">
        <!-- Conta -->
        <div class="form-group">
          <label for="conta">Conta *</label>
          <select
            id="conta"
            formControlName="conta"
            [class.invalid]="despesaForm.get('conta')?.invalid && despesaForm.get('conta')?.touched"
          >
            <option value="">Selecione a conta</option>
            <option
              *ngFor="let conta of contasAtivas"
              [value]="conta.uuid"
            >
              {{ conta.name }} ({{ conta.bank?.name }})
            </option>
          </select>
          <small class="error-message" *ngIf="despesaForm.get('conta')?.invalid && despesaForm.get('conta')?.touched">
            Selecione uma conta
          </small>
        </div>

        <!-- Valor -->
        <div class="form-group">
          <label for="valor">Valor da Despesa *</label>
          <input
            type="number"
            id="valor"
            formControlName="valor"
            placeholder="0,00"
            step="0.01"
            min="0.01"
            [class.invalid]="despesaForm.get('valor')?.invalid && despesaForm.get('valor')?.touched"
          />
          <small class="error-message" *ngIf="despesaForm.get('valor')?.hasError('required') && despesaForm.get('valor')?.touched">
            Informe o valor da despesa
          </small>
          <small class="error-message" *ngIf="despesaForm.get('valor')?.hasError('min') && despesaForm.get('valor')?.touched">
            O valor deve ser maior que zero
          </small>
        </div>

        <!-- Categoria -->
        <div class="form-group">
          <label for="categoria">Categoria *</label>
          <select
            id="categoria"
            formControlName="categoria"
            [class.invalid]="despesaForm.get('categoria')?.invalid && despesaForm.get('categoria')?.touched"
            [disabled]="loadingCategorias"
          >
            <option value="">{{ loadingCategorias ? 'Carregando...' : 'Selecione a categoria' }}</option>
            <option
              *ngFor="let categoria of categorias"
              [value]="categoria.uuid"
            >
              {{ categoria.icon }} {{ categoria.description }}
            </option>
          </select>
          <small class="error-message" *ngIf="despesaForm.get('categoria')?.invalid && despesaForm.get('categoria')?.touched">
            Selecione uma categoria
          </small>
        </div>

        <!-- DescriÃ§Ã£o -->
        <div class="form-group">
          <label for="descricao">DescriÃ§Ã£o *</label>
          <input
            type="text"
            id="descricao"
            formControlName="descricao"
            placeholder="Ex: Supermercado"
            [class.invalid]="despesaForm.get('descricao')?.invalid && despesaForm.get('descricao')?.touched"
          />
          <small class="error-message" *ngIf="despesaForm.get('descricao')?.hasError('required') && despesaForm.get('descricao')?.touched">
            Informe a descriÃ§Ã£o
          </small>
          <small class="error-message" *ngIf="despesaForm.get('descricao')?.hasError('minlength') && despesaForm.get('descricao')?.touched">
            A descriÃ§Ã£o deve ter pelo menos 3 caracteres
          </small>
        </div>

        <!-- Data -->
        <div class="form-group">
          <label for="data">Data *</label>
          <input
            type="date"
            id="data"
            formControlName="data"
            [class.invalid]="despesaForm.get('data')?.invalid && despesaForm.get('data')?.touched"
          />
          <small class="error-message" *ngIf="despesaForm.get('data')?.invalid && despesaForm.get('data')?.touched">
            Selecione a data
          </small>
        </div>

        <!-- BotÃµes -->
        <div class="modal-actions">
          <button
            type="button"
            class="btn-cancelar"
            (click)="fecharModal()"
            [disabled]="loading"
          >
            Cancelar
          </button>
          <button
            type="submit"
            class="btn-adicionar"
            [disabled]="loading || despesaForm.invalid"
          >
            {{ loading ? 'Adicionando...' : 'Adicionar Despesa' }}
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
