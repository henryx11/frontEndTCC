<div class="container">
  <div class="header">
    <h2>CartÃµes:</h2>
    <button class="btn-reload" (click)="recarregarDados()" [disabled]="loading">
      <span *ngIf="loading" class="spinning">ğŸ”„</span>
      <span *ngIf="!loading">â†»</span>
      {{ loading ? 'Carregando...' : 'Atualizar' }}
    </button>
  </div>

  <div class="cards" *ngIf="!loading && cartoes.length > 0">
    <div class="card"
         *ngFor="let cartao of cartoes"
         (click)="selecionarCartao(cartao.uuid)"
         [class.selected]="cartaoSelecionado === cartao.uuid">
      <div class="card-content">
        <h4>{{ cartao.description }}</h4>
        <p class="card-bandeira">{{ cartao.flags.name }}</p>
        <p class="card-limite">Limite: {{ cartao.limite | currency:'BRL':'symbol':'1.2-2' }}</p>
        <p class="card-faturas" *ngIf="cartao.faturas && cartao.faturas.length > 0">
          {{ cartao.faturas.length }} fatura(s)
        </p>
      </div>
    </div>
    <div class="card create-card" routerLink="/create-card">
      <div class="card-content">
        <span class="plus-icon">+</span>
        <span>Criar CartÃ£o</span>
      </div>
    </div>
  </div>

  <div class="empty-state" *ngIf="!loading && cartoes.length === 0">
    <div class="empty-icon">ğŸ’³</div>
    <p>VocÃª ainda nÃ£o possui cartÃµes cadastrados</p>
    <button class="btn-create-first" routerLink="/create-card">
      Criar Primeiro CartÃ£o
    </button>
  </div>

  <div class="loading-state" *ngIf="loading">
    <div class="spinner"></div>
    <p>Carregando cartÃµes...</p>
  </div>

  <!-- BalÃ£o da fatura que aparece quando um cartÃ£o Ã© selecionado -->
  <div class="fatura" *ngIf="cartaoSelecionado && getFaturaAtual()">
    <!-- Header da fatura com navegaÃ§Ã£o -->
    <div class="fatura-header">
      <button
        class="nav-arrow nav-arrow-left"
        (click)="faturaAnterior()"
        [disabled]="!podeVoltar()"
        [class.disabled]="!podeVoltar()"
        title="Fatura anterior">
        &#8249;
      </button>

      <div class="fatura-title">
        <h3>{{ getNomeCartao() }}</h3>
        <p class="fatura-periodo">{{ getMesAnoFatura() }}</p>
      </div>

      <button
        class="nav-arrow nav-arrow-right"
        (click)="proximaFatura()"
        [disabled]="!podeAvancar()"
        [class.disabled]="!podeAvancar()"
        title="PrÃ³xima fatura">
        &#8250;
      </button>
    </div>

    <!-- InformaÃ§Ãµes da fatura -->
    <div class="fatura-info">
      <div class="fatura-item">
        <span class="label">Valor da Fatura:</span>
        <span class="value valor-fatura" [class]="getStatusFatura().toLowerCase().replace(' ', '-')">
          {{ getFaturaValor() }}
        </span>
      </div>

      <div class="fatura-item">
        <span class="label">Valor Pago:</span>
        <span class="value valor-pago">
          {{ getValorPago() }}
        </span>
      </div>

      <div class="fatura-item">
        <span class="label">Data de Fechamento:</span>
        <span class="value">{{ getDataFechamento() }}</span>
      </div>

      <div class="fatura-item">
        <span class="label">Data de Vencimento:</span>
        <span class="value">{{ getDataVencimento() }}</span>
      </div>

      <div class="fatura-item">
        <span class="label">Limite DisponÃ­vel:</span>
        <span class="value limite">{{ getLimiteDisponivel() }}</span>
      </div>

      <div class="fatura-item">
        <span class="label">Status:</span>
        <span class="value status" [class]="getStatusFatura().toLowerCase().replace(' ', '-')">
          {{ getStatusFatura() }}
        </span>
      </div>
    </div>

    <!-- Indicador de navegaÃ§Ã£o (pontos) -->
    <div class="fatura-indicator" *ngIf="getCartaoSelecionado() && getCartaoSelecionado()!.faturas">
      <span
        *ngFor="let fatura of getCartaoSelecionado()!.faturas; let i = index"
        class="indicator-dot"
        [class.active]="i === faturaAtualIndex"
        [title]="fatura.mes + ' ' + fatura.ano"
        (click)="faturaAtualIndex = i">
      </span>
    </div>

    <!-- AÃ§Ãµes da fatura -->
    <div class="fatura-actions">
      <button
        class="btn-pagar"
        (click)="pagarFatura()"
        [disabled]="getStatusFatura() === 'Pago' || getStatusFatura() === 'Futura'">
        <span *ngIf="getStatusFatura() === 'Pago'">âœ“ Pago</span>
        <span *ngIf="getStatusFatura() === 'Futura'">Fatura Futura</span>
        <span *ngIf="getStatusFatura() === 'Fechamento Pendente'">Pagar PendÃªncia</span>
        <span *ngIf="getStatusFatura() === 'Em aberto'">Pagar Fatura</span>
      </button>

      <button class="btn-detalhes" (click)="verDetalhes()">
        Ver Detalhes
      </button>

      <button class="btn-fechar" (click)="fecharFatura()" title="Fechar">
        âœ•
      </button>
    </div>
  </div>

  <!-- Mensagem quando nÃ£o hÃ¡ faturas -->
  <div class="no-faturas" *ngIf="cartaoSelecionado && getCartaoSelecionado() && (!getCartaoSelecionado()!.faturas || getCartaoSelecionado()!.faturas.length === 0)">
    <div class="no-faturas-content">
      <p>Este cartÃ£o ainda nÃ£o possui faturas</p>
      <button class="btn-fechar-no-faturas" (click)="fecharFatura()">Fechar</button>
    </div>
  </div>
</div>
