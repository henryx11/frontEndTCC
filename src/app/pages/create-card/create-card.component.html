<div class="container">
  <h1>Criar Cartão</h1>
  <form [formGroup]="cartaoForm" (ngSubmit)="criarCartao()" class="create-card">
    <div class="form-group">
      <label for="descricao">Descrição *</label>
      <input
        type="text"
        id="descricao"
        formControlName="descricao"
        placeholder="Nome do cartão"
        [class.invalid]="cartaoForm.get('descricao')?.invalid && cartaoForm.get('descricao')?.touched"
      />
      <small class="error-message" *ngIf="cartaoForm.get('descricao')?.invalid && cartaoForm.get('descricao')?.touched">
        Informe a descrição do cartão
      </small>
    </div>

    <div class="form-group">
      <label for="conta">Conta Vinculada *</label>
      <select
        id="conta"
        formControlName="conta"
        [class.invalid]="cartaoForm.get('conta')?.invalid && cartaoForm.get('conta')?.touched"
        [disabled]="loadingContas"
      >
        <option value="">{{ loadingContas ? 'Carregando contas...' : 'Selecione uma conta' }}</option>
        <option
          *ngFor="let conta of contas"
          [value]="conta.uuid"
        >
          {{ conta.name }} ({{ conta.bank?.name }}) - Saldo: R$ {{ conta.balance | number:'1.2-2' }}
        </option>
      </select>
      <small class="error-message" *ngIf="cartaoForm.get('conta')?.invalid && cartaoForm.get('conta')?.touched">
        Selecione uma conta para vincular ao cartão
      </small>
    </div>

    <div class="form-group">
      <label for="bandeira">Bandeira *</label>
      <select
        id="bandeira"
        formControlName="bandeira"
        [class.invalid]="cartaoForm.get('bandeira')?.invalid && cartaoForm.get('bandeira')?.touched"
        [disabled]="loadingBandeiras"
      >
        <option value="">{{ loadingBandeiras ? 'Carregando bandeiras...' : 'Selecione uma bandeira' }}</option>
        <option
          *ngFor="let flag of bandeiras"
          [value]="flag.uuid"
        >
          {{ flag.name }}
        </option>
      </select>
      <small class="error-message" *ngIf="cartaoForm.get('bandeira')?.invalid && cartaoForm.get('bandeira')?.touched">
        Selecione uma bandeira
      </small>
    </div>

    <div class="form-group">
      <label for="limite">Limite *</label>
      <input
        type="number"
        id="limite"
        formControlName="limite"
        placeholder="0,00"
        step="0.01"
        min="0"
        [class.invalid]="cartaoForm.get('limite')?.invalid && cartaoForm.get('limite')?.touched"
      />
      <small class="error-message" *ngIf="cartaoForm.get('limite')?.hasError('required') && cartaoForm.get('limite')?.touched">
        Informe o limite do cartão
      </small>
      <small class="error-message" *ngIf="cartaoForm.get('limite')?.hasError('min') && cartaoForm.get('limite')?.touched">
        O limite deve ser maior que zero
      </small>
    </div>

    <div class="form-group">
      <label for="dataFechamento">Data de Fechamento *</label>
      <input
        type="date"
        id="dataFechamento"
        formControlName="dataFechamento"
        [class.invalid]="cartaoForm.get('dataFechamento')?.invalid && cartaoForm.get('dataFechamento')?.touched"
      />
      <small class="error-message" *ngIf="cartaoForm.get('dataFechamento')?.invalid && cartaoForm.get('dataFechamento')?.touched">
        Informe a data de fechamento
      </small>
    </div>

    <div class="form-group">
      <label for="dataVencimento">Data de Vencimento *</label>
      <input
        type="date"
        id="dataVencimento"
        formControlName="dataVencimento"
        [class.invalid]="cartaoForm.get('dataVencimento')?.invalid && cartaoForm.get('dataVencimento')?.touched"
      />
      <small class="error-message" *ngIf="cartaoForm.get('dataVencimento')?.invalid && cartaoForm.get('dataVencimento')?.touched">
        Informe a data de vencimento
      </small>
      <small class="error-message" *ngIf="cartaoForm.hasError('datasInvalidas')">
        ⚠️ A data de fechamento deve ser anterior à data de vencimento
      </small>
    </div>

    <div class="form-actions">
      <button
        type="submit"
        class="btn-create"
        [disabled]="cartaoForm.invalid || loading || loadingContas || loadingBandeiras">
        <span *ngIf="!loading">Criar Cartão</span>
        <span *ngIf="loading">Criando...</span>
      </button>
    </div>

    <div class="form-actions-secondary">
      <button
        type="button"
        class="btn-cancel"
        (click)="cancelar()"
        [disabled]="loading">
        Cancelar
      </button>
    </div>
  </form>
</div>
