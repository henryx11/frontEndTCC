<div class="container">
  <div class="header">
    <h2>Contas:</h2>
    <button class="btn-reload" (click)="recarregarDados()" [disabled]="loading">
      <span *ngIf="loading">ğŸ”„</span>
      <span *ngIf="!loading">â†»</span>
      {{ loading ? 'Carregando...' : 'Atualizar' }}
    </button>
  </div>

  <div class="cards" *ngIf="!loading">
    <div class="card"
         *ngFor="let conta of contas"
         [class.selected]="contaSelecionada === conta.uuid"
         [class.desativada]="!isContaAtiva(conta)">

      <!-- BotÃ£o de ativar/desativar -->
      <button class="btn-toggle-status"
              (click)="toggleContaStatus($event, conta)"
              [title]="isContaAtiva(conta) ? 'Desativar conta' : 'Ativar conta'">
        <span *ngIf="isContaAtiva(conta)">ğŸ”’</span>
        <span *ngIf="!isContaAtiva(conta)">ğŸ”“</span>
      </button>

      <div class="card-content" (click)="selecionarConta(conta.uuid)">
        <div class="card-header">
          <h4>{{ conta.name }}</h4>
          <span class="badge-desativada" *ngIf="!isContaAtiva(conta)">Desativada</span>
        </div>
        <p class="card-banco">{{ conta.bank?.name }}</p>
        <p class="card-saldo">Saldo: R$ {{ conta.balance | number:'1.2-2' }}</p>
      </div>
    </div>

    <div class="card create-card" routerLink="/create-account">
      <div class="card-content">
        <span class="plus-icon">+</span>
        <span>Criar Conta</span>
      </div>
    </div>
  </div>

  <div class="loading-state" *ngIf="loading">
    <div class="spinner"></div>
    <p>Carregando contas...</p>
  </div>

  <!-- Detalhes da conta selecionada -->
  <div class="fatura" *ngIf="contaSelecionada && getContaSelecionada()">
    <div class="fatura-header">
      <div class="fatura-title">
        <!-- Modo de visualizaÃ§Ã£o -->
        <div class="nome-container" *ngIf="!editandoNome">
          <h3>{{ getContaSelecionada()?.name }}</h3>
          <button class="btn-editar-nome" (click)="iniciarEdicaoNome()" title="Editar nome">
            âœï¸
          </button>
        </div>

        <!-- Modo de ediÃ§Ã£o -->
        <div class="nome-edicao" *ngIf="editandoNome">
          <input
            type="text"
            [(ngModel)]="nomeEditado"
            (keydown)="onKeyDown($event)"
            [disabled]="salvandoNome"
            class="input-nome"
            placeholder="Nome da conta"
            autofocus
          />
          <div class="edicao-actions">
            <button
              class="btn-salvar-nome"
              (click)="salvarNome()"
              [disabled]="salvandoNome"
              title="Salvar (Enter)">
              <span *ngIf="!salvandoNome">âœ“</span>
              <span *ngIf="salvandoNome">â³</span>
            </button>
            <button
              class="btn-cancelar-nome"
              (click)="cancelarEdicao()"
              [disabled]="salvandoNome"
              title="Cancelar (Esc)">
              âœ•
            </button>
          </div>
        </div>

        <p class="fatura-periodo">{{ getContaSelecionada()?.bank?.name }}</p>
      </div>
    </div>

    <div class="fatura-info">
      <div class="fatura-item">
        <span class="label">Banco:</span>
        <span class="value">{{ getContaSelecionada()?.bank?.name }}</span>
      </div>

      <div class="fatura-item">
        <span class="label">Tipo de Conta:</span>
        <span class="value">{{ getContaSelecionada()?.type?.description }}</span>
      </div>

      <div class="fatura-item">
        <span class="label">Saldo Atual:</span>
        <span class="value limite">R$ {{ getContaSelecionada()?.balance | number:'1.2-2' }}</span>
      </div>
    </div>

    <div class="fatura-actions">
      <button class="btn-pagar" (click)="abrirModalTransferencia()">
        Nova TransferÃªncia
      </button>

      <button class="btn-detalhes" (click)="verExtrato()">
        Ver Extrato
      </button>

      <button class="btn-fechar" (click)="fecharDetalhes()">
        âœ•
      </button>
    </div>
  </div>

  <!-- Modal de TransferÃªncia -->
  <app-transfer-modal
    *ngIf="modalTransferenciaAberto"
    [contaOrigem]="getContaSelecionada()!"
    [todasContas]="contas"
    (fechar)="fecharModalTransferencia()"
    (transferenciaRealizada)="onTransferenciaRealizada()"
  ></app-transfer-modal>
</div>
