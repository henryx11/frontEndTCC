<app-default-login-layout
  title="Nova senha"
  primaryBtnText="Redefinir senha"
  secondaryBtnText="Voltar ao login"
  (submit)="submit()"
  (navigate)="navigate()"
  [disablePrimaryBtn]="!resetPasswordForm.valid || isLoading"
>
  <form [formGroup]="resetPasswordForm">
    <!-- Estado de validação do token -->
    <div class="loading-state" *ngIf="validatingToken">
      <div class="spinner"></div>
      <p>Validando link...</p>
    </div>

    <!-- Token inválido ou expirado -->
    <div class="error-state" *ngIf="!validatingToken && !isTokenValid">
      <div class="error-icon">✕</div>
      <p>Link inválido ou expirado</p>
      <span>Este link de recuperação não é mais válido. Solicite um novo link de recuperação.</span>
    </div>

    <!-- Formulário de nova senha -->
    <ng-container *ngIf="!validatingToken && isTokenValid && !resetSuccess">
      <p class="description">
        Digite sua nova senha abaixo.
      </p>

      <app-primary-imput
        formControlName="newPassword"
        inputName="newPassword"
        type="password"
        label="Nova Senha"
        placeholder="Mínimo 6 caracteres"
      >
      </app-primary-imput>

      <app-primary-imput
        formControlName="confirmPassword"
        inputName="confirmPassword"
        type="password"
        label="Confirmar Senha"
        placeholder="Digite a senha novamente"
      >
      </app-primary-imput>

      <!-- Mensagem de erro quando senhas não conferem -->
      <div class="validation-error" *ngIf="resetPasswordForm.hasError('passwordMismatch') &&
                 resetPasswordForm.get('confirmPassword')?.touched">
        As senhas não coincidem
      </div>
    </ng-container>

    <!-- Sucesso -->
    <div class="success-message" *ngIf="resetSuccess">
      <div class="success-icon">✓</div>
      <p>Senha alterada com sucesso!</p>
      <span>Você será redirecionado para o login em instantes.</span>
    </div>
  </form>
</app-default-login-layout>
